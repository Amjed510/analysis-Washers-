# ğŸ“‹ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠ - Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø£ÙˆÙ„

## Ù†Ø¸Ø§Ù… WashPOS Ø¨Ù‡ÙŠÙƒÙ„ÙŠØ© Offline-First (Local-First)

---

> [!IMPORTANT] > **Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ©:** Offline-First / Local-First  
> **Ø§Ù„Ù…Ø¨Ø¯Ø£:** Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØªÙ… Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… ØªÙØ²Ø§Ù…Ù† Ù„Ù„Ø³Ø­Ø§Ø¨Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹  
> **Ù…Ù†Ø§Ø³Ø¨ Ù„Ù€:** Ø§Ù„Ù…ØºØ§Ø³Ù„ ÙÙŠ Ù…Ù†Ø§Ø·Ù‚ Ø¶Ø¹ÙŠÙØ© Ø§Ù„Ø´Ø¨ÙƒØ© (Ù…ÙˆØ§Ù‚Ù Ø³ÙÙ„ÙŠØ©)

---

## 1. Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

### 1.1 Ø§Ù„Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

```
"Ø§Ù„Ø¹Ù…Ù„ Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø£Ø¨Ø¯Ø§Ù‹ - Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª"
```

### 1.2 Ù…Ø®Ø·Ø· Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ø§Ù…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Offline-First Architecture                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Ø¥Ù†Ø´Ø§Ø¡   â”‚â”€â”€â”€â–¶â”‚ Ø­ÙØ¸ ÙÙŠ   â”‚â”€â”€â”€â–¶â”‚ Ø·Ø¨Ø§Ø¹Ø©   â”‚â”€â”€â”€â–¶â”‚ ØªÙˆÙ„ÙŠØ¯  â”‚ â”‚
â”‚   â”‚ Ø·Ù„Ø¨    â”‚    â”‚ Isar DB  â”‚    â”‚ ÙØ§ØªÙˆØ±Ø©  â”‚    â”‚ QR     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚               â”‚ Sync Queue     â”‚                           â”‚
â”‚               â”‚ (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)â”‚                           â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                        â”‚                                    â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚            â”‚           â”‚           â”‚                       â”‚
â”‚            â–¼           â–¼           â–¼                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚       â”‚ Order1 â”‚  â”‚ Order2 â”‚  â”‚ Order3 â”‚                  â”‚
â”‚       â”‚ Pendingâ”‚  â”‚ Pendingâ”‚  â”‚ Synced â”‚                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                    Ø¹Ù†Ø¯ ØªÙˆÙØ± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª                        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                             â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚               â”‚ Background     â”‚                           â”‚
â”‚               â”‚ Sync Worker    â”‚                           â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚               â”‚ Cloud Server   â”‚                           â”‚
â”‚               â”‚ (API Backend)  â”‚                           â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©

### 2.1 Ø§Ù„ÙˆØ­Ø¯Ø© 1: Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© (Core & Database)

| Ø§Ù„Ù…ØªØ·Ù„Ø¨              | Ø§Ù„ÙˆØµÙ                                    | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
| -------------------- | ---------------------------------------- | -------- |
| **Isar Database**    | Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© Ø³Ø±ÙŠØ¹Ø© NoSQL           | Ø­Ø±Ø¬      |
| **Schema Design**    | ØªØµÙ…ÙŠÙ… Service, Order, OrderItem, Payment | Ø­Ø±Ø¬      |
| **Data Models**      | Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ø¶Ø­Ø©           | Ø¹Ø§Ù„ÙŠØ©    |
| **Migration System** | Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ Schema                    | Ù…ØªÙˆØ³Ø·Ø©   |

#### Isar Schemas

```dart
@collection
class Order {
  Id id = Isar.autoIncrement;

  String? localId;           // UUID Ù…Ø­Ù„ÙŠ ÙØ±ÙŠØ¯
  String? serverId;          // ID Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©

  DateTime createdAt = DateTime.now();

  double totalAmount = 0;
  double paidAmount = 0;
  double? changeAmount;

  @enumerated
  PaymentType paymentType = PaymentType.cash;

  @enumerated
  OrderStatus status = OrderStatus.pending;

  @enumerated
  SyncStatus syncStatus = SyncStatus.pending;

  final items = IsarLinks<OrderItem>();
}

@collection
class OrderItem {
  Id id = Isar.autoIncrement;

  String serviceName = '';
  double price = 0;
  int quantity = 1;

  @Backlink(to: 'items')
  final order = IsarLink<Order>();
}

enum PaymentType { cash, card }
enum OrderStatus { pending, completed, cancelled }
enum SyncStatus { pending, syncing, synced, failed }
```

### 2.2 Ø§Ù„ÙˆØ­Ø¯Ø© 2: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± (POS Interface)

| Ø§Ù„Ù…ØªØ·Ù„Ø¨           | Ø§Ù„ÙˆØµÙ                       | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
| ----------------- | --------------------------- | -------- |
| **Grid Layout**   | Ø´Ø¨ÙƒØ© Ø®Ø¯Ù…Ø§Øª Ø¨Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø©     | Ø¹Ø§Ù„ÙŠØ©    |
| **Category Tabs** | ØªØ¨ÙˆÙŠØ¨Ø§Øª (ØºØ³ÙŠÙ„/ØªÙ„Ù…ÙŠØ¹/Ø¥Ø¶Ø§ÙØ§Øª) | Ø¹Ø§Ù„ÙŠØ©    |
| **Size Filter**   | ÙÙ„ØªØ± Ø­Ø¬Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©            | Ø¹Ø§Ù„ÙŠØ©    |
| **Cart Widget**   | Ø³Ù„Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ      | Ø¹Ø§Ù„ÙŠØ©    |
| **Calculator**    | Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ      | Ø¹Ø§Ù„ÙŠØ©    |

#### ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¢ Online â”‚ WashPOS                           [â‰¡] Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ØºØ³ÙŠÙ„  â”‚  ØªÙ„Ù…ÙŠØ¹  â”‚ Ø¥Ø¶Ø§ÙØ§Øª â”‚    â”‚     ğŸ›’ Ø§Ù„Ø³Ù„Ø©      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                   â”‚  â”‚
â”‚                                      â”‚ ØºØ³ÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ   45  â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ   35  â”‚  â”‚
â”‚  â”‚ ØµØºÙŠØ±Ø© â”‚ Ù…ØªÙˆØ³Ø·Ø© â”‚ ÙƒØ¨ÙŠØ±Ø©    â”‚     â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚                                      â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:  80 Ø±.Ø³â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”‚                   â”‚  â”‚
â”‚  â”‚ ğŸš—    â”‚ â”‚ ğŸš—    â”‚ â”‚ ğŸš—    â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ Ø¯Ø§Ø®Ù„ÙŠ â”‚ â”‚ Ø®Ø§Ø±Ø¬ÙŠ â”‚ â”‚ Ø´Ø§Ù…Ù„  â”‚     â”‚ â”‚  Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙØ¹ â”‚ â”‚  â”‚
â”‚  â”‚ 45 Ø±.Ø³â”‚ â”‚ 35 Ø±.Ø³â”‚ â”‚ 70 Ø±.Ø³â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Ø§Ù„ÙˆØ­Ø¯Ø© 3: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Payment Logic)

#### Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø±Ø·ÙŠ Ù„Ù„Ø¯ÙØ¹

```dart
Future<PaymentResult> processPayment({
  required Order order,
  required PaymentType type,
  required double paidAmount,
}) async {

  if (type == PaymentType.cash) {
    // ========== Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ==========
    // âœ… ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª

    order.paidAmount = paidAmount;
    order.changeAmount = paidAmount - order.totalAmount;
    order.status = OrderStatus.completed;
    order.syncStatus = SyncStatus.pending;

    // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
    await _isarService.saveOrder(order);

    // ØªÙˆÙ„ÙŠØ¯ QR Code (ZATCA Phase 1)
    final qrCode = _zatcaService.generateQR(order);

    // Ø·Ø¨Ø§Ø¹Ø© ÙÙˆØ±ÙŠØ©
    await _printerService.printReceipt(order, qrCode);

    // Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    await _syncQueue.add(order);

    return PaymentResult.success();

  } else {
    // ========== Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ==========
    // âŒ ÙŠØªØ·Ù„Ø¨ Ø¥Ù†ØªØ±Ù†Øª

    final isConnected = await _connectivityService.isConnected;

    if (!isConnected) {
      return PaymentResult.failure(
        message: 'Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙŠØªØ·Ù„Ø¨ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
        suggestedAction: SuggestedAction.switchToCash,
      );
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹
    final bankResult = await _paymentGateway.processCard(order);

    if (bankResult.isSuccess) {
      order.status = OrderStatus.completed;
      order.syncStatus = SyncStatus.synced; // ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø¨Ù†Ùƒ

      await _isarService.saveOrder(order);
      await _printerService.printReceipt(order, qrCode);

      return PaymentResult.success();
    } else {
      return PaymentResult.failure(message: bankResult.error);
    }
  }
}
```

### 2.4 Ø§Ù„ÙˆØ­Ø¯Ø© 4: Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Hardware Integration)

| Ø§Ù„Ù…ØªØ·Ù„Ø¨           | Ø§Ù„ÙˆØµÙ                  | Ø§Ù„Ø­Ø²Ù…Ø©               |
| ----------------- | ---------------------- | -------------------- |
| **Text Printing** | Ø·Ø¨Ø§Ø¹Ø© Ù†Øµ Ø¨Ø£Ø­Ø¬Ø§Ù… Ù…Ø®ØªÙ„ÙØ© | `sunmi_printer_plus` |
| **QR Code**       | Ø·Ø¨Ø§Ø¹Ø© Ø±Ù…Ø² ZATCA        | `sunmi_printer_plus` |
| **Logo**          | Ø·Ø¨Ø§Ø¹Ø© Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØºØ³Ù„Ø©     | `sunmi_printer_plus` |
| **Paper Cut**     | Ù‚Ø·Ø¹ Ø§Ù„ÙˆØ±Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© | `sunmi_printer_plus` |

#### ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥ÙŠØµØ§Ù„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ğŸš— Ù…ØºØ³Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª        â”‚
â”‚    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: 300xxxxxxxxx  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: INV-2024-001234  â”‚
â”‚ Ø§Ù„ØªØ§Ø±ÙŠØ®: 11/12/2024 14:30      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ØºØ³ÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ    1 x 45.00  45.00 â”‚
â”‚ ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ    1 x 35.00  35.00 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:              80.00 Ø±.Ø³ â”‚
â”‚ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%):        12.00 Ø±.Ø³ â”‚
â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:             92.00 Ø±.Ø³ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ù…Ø¯ÙÙˆØ¹:             100.00 Ø±.Ø³ â”‚
â”‚ Ø§Ù„Ø¨Ø§Ù‚ÙŠ:                8.00 Ø±.Ø³ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚          â”‚ QR CODE â”‚            â”‚
â”‚          â”‚ (ZATCA) â”‚            â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                 â”‚
â”‚     Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…! ğŸš—          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 Ø§Ù„ÙˆØ­Ø¯Ø© 5: Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (Sync Worker)

```dart
class SyncWorker {
  final IsarService _isar;
  final ApiClient _api;
  final ConnectivityService _connectivity;

  Timer? _syncTimer;

  void startBackgroundSync() {
    _syncTimer = Timer.periodic(
      Duration(minutes: 5),
      (_) => _syncPendingOrders(),
    );

    // Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    _connectivity.onConnected.listen((_) => _syncPendingOrders());
  }

  Future<void> _syncPendingOrders() async {
    if (!await _connectivity.isConnected) return;

    final pendingOrders = await _isar.getOrdersByStatus(SyncStatus.pending);

    for (final order in pendingOrders) {
      try {
        order.syncStatus = SyncStatus.syncing;
        await _isar.saveOrder(order);

        final response = await _api.postOrder(order);

        order.serverId = response.id;
        order.syncStatus = SyncStatus.synced;
        await _isar.saveOrder(order);

      } catch (e) {
        order.syncStatus = SyncStatus.failed;
        await _isar.saveOrder(order);
      }
    }
  }
}
```

---

## 3. Ø§Ù„Ù…ÙƒØ¯Ø³ Ø§Ù„ØªÙ‚Ù†ÙŠ

| Ø§Ù„ÙØ¦Ø©            | Ø§Ù„Ø­Ø²Ù…Ø©                  | Ø§Ù„Ø¥ØµØ¯Ø§Ø± | Ø§Ù„Ø³Ø¨Ø¨                     |
| ---------------- | ----------------------- | ------- | ------------------------- |
| **Database**     | `isar`                  | ^3.1.0  | Ø³Ø±ÙŠØ¹ØŒ NoSQLØŒ ÙŠØ¯Ø¹Ù… Offline |
| **State**        | `get`                   | ^4.6.5  | Ø¨Ø³ÙŠØ· ÙˆÙ‚ÙˆÙŠ                 |
| **Hardware**     | `sunmi_printer_plus`    | ^1.3.5  | Ø±Ø³Ù…ÙŠ Ù„Ù€ SUNMI             |
| **ZATCA**        | `zatca_fatoora_flutter` | ^1.0.0  | QR Code Ù…ØªÙˆØ§ÙÙ‚            |
| **Network**      | `dio`                   | ^5.4.0  | Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©                  |
| **Connectivity** | `connectivity_plus`     | ^5.0.2  | Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´Ø¨ÙƒØ©             |
| **Background**   | `workmanager`           | ^0.5.1  | Ù…Ø²Ø§Ù…Ù†Ø© Ø®Ù„ÙÙŠØ©              |

---

## 4. Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
lib/
â”œâ”€â”€ main.dart
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ bindings/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ themes/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ isar_service.dart
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚       â”œâ”€â”€ order.dart
â”‚   â”‚       â”œâ”€â”€ order_item.dart
â”‚   â”‚       â”œâ”€â”€ service.dart
â”‚   â”‚       â””â”€â”€ payment.dart
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ printer_service.dart
â”‚   â”‚   â”œâ”€â”€ zatca_service.dart
â”‚   â”‚   â””â”€â”€ sync_service.dart
â”‚   â””â”€â”€ network/
â”‚       â”œâ”€â”€ api_client.dart
â”‚       â”œâ”€â”€ connectivity_service.dart
â”‚       â””â”€â”€ sync_worker.dart
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ pos/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ pos_controller.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ cart_controller.dart
â”‚   â”‚   â”‚   â””â”€â”€ payment_controller.dart
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ pos_screen.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ payment_screen.dart
â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚       â”œâ”€â”€ service_grid.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ cart_widget.dart
â”‚   â”‚   â”‚       â””â”€â”€ calculator_widget.dart
â”‚   â”‚   â””â”€â”€ bindings/
â”‚   â”œâ”€â”€ shift/
â”‚   â””â”€â”€ reports/
â””â”€â”€ widgets/
    â”œâ”€â”€ connectivity_indicator.dart
    â””â”€â”€ sync_status_badge.dart
```

---

## 5. Ø§Ù„Ù…Ø²Ø§ÙŠØ§ ÙˆØ§Ù„Ø¹ÙŠÙˆØ¨

### âœ… Ø§Ù„Ù…Ø²Ø§ÙŠØ§

| Ø§Ù„Ù…ÙŠØ²Ø©              | Ø§Ù„ÙˆØµÙ                          |
| ------------------- | ------------------------------ |
| **Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø¹Ù…Ù„** | Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª |
| **Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ©**      | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø­Ù„ÙŠØ©            |
| **Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ©**       | Ù„Ø§ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±          |
| **Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**  | Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹         |

### âŒ Ø§Ù„Ø¹ÙŠÙˆØ¨

| Ø§Ù„Ø¹ÙŠØ¨                     | Ø§Ù„ÙˆØµÙ                             |
| ------------------------- | --------------------------------- |
| **ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©**        | Ù…Ù†Ø·Ù‚ Ù…Ø¹Ù‚Ø¯ Ù„Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª           |
| **Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØªØªØ·Ù„Ø¨ Ø¥Ù†ØªØ±Ù†Øª** | Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø§ ÙŠØ¹Ù…Ù„ Offline  |
| **Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±**        | Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ ØªØªØ£Ø®Ø± Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø³ÙŠØ±ÙØ± |
| **Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†**         | ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù€ Isar              |

---

## 6. Ø®Ø§Ø±Ø·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚

| Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ | Ø§Ù„Ù…Ù‡Ù…Ø©                      |
| ------- | --------------------------- |
| 1-2     | Ø¥Ø¹Ø¯Ø§Ø¯ Flutter + Isar + GetX |
| 3-4     | ÙˆØ§Ø¬Ù‡Ø© POS + Ø§Ù„Ø³Ù„Ø©           |
| 5-6     | Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© + ZATCA QR          |
| 7-8     | Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙØ¹                  |
| 9-10    | Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©            |
| 11-12   | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª              |

---

## 7. Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²

| Ø§Ù„Ø¨Ù†Ø¯        | Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª             |
| ------------ | --------------------- |
| **Ø§Ù„Ø¬Ù‡Ø§Ø²**   | SUNMI V2s             |
| **Android**  | 7.1+                  |
| **Ø§Ù„ØªØ®Ø²ÙŠÙ†**  | 500MB+ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ + Isar |
| **Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª** | WiFi Ø£Ùˆ 4G (Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©) |

---

## 8. Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© (Research-Based Best Practices)

> [!NOTE]
> Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ø³ØªØ®Ù„ØµØ© Ù…Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª ÙÙŠ Ø£Ù†Ø¸Ù…Ø© POS Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©

### 8.1 Store-and-Forward: Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª

ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©ØŒ ØªÙ‚Ù†ÙŠØ© **Store-and-Forward** Ù‡ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ ÙÙŠ Ø£Ù†Ø¸Ù…Ø© POS Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ offline:

| Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø©               | Ø§Ù„ÙˆØµÙ                                          | Ø§Ù„Ù…ØµØ¯Ø±              |
| ---------------------- | ---------------------------------------------- | ------------------- |
| **Transaction Limits** | ÙˆØ¶Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Offline (Ù…Ø«Ø§Ù„: 100 Ø±ÙŠØ§Ù„) | Shopify, Wallester  |
| **Time Window**        | Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ØªÙØ­ÙØ¸ 24-72 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·                 | Electronic Payments |
| **Customer Contact**   | Ø¬Ù…Ø¹ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¥Ø°Ø§ Ø±ÙÙØ¶Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© | Shopify             |
| **EMV Cryptogram**     | Ø¨Ø·Ø§Ù‚Ø§Øª Chip ØªÙˆÙ„Ø¯ Ø±Ù…Ø² ØªØ´ÙÙŠØ± ÙŠÙØ±Ø³Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹        | FarmersMarket POS   |

### 8.2 Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Offline (PCI DSS Compliance)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Encryption at Rest (AES-256)                           â”‚
â”‚     â””â”€â–º Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø´ÙØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²                    â”‚
â”‚                                                             â”‚
â”‚  2. Tokenization                                            â”‚
â”‚     â””â”€â–º Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù€ Token                        â”‚
â”‚                                                             â”‚
â”‚  3. EMV End-to-End Encryption (E2EE)                       â”‚
â”‚     â””â”€â–º ØªØ´ÙÙŠØ± Ù…Ù† Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø¨Ù†Ùƒ                         â”‚
â”‚                                                             â”‚
â”‚  4. Minimal Data Storage                                    â”‚
â”‚     â””â”€â–º Ø­ÙØ¸ Ø£Ù‚Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù…ÙƒÙ†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª (Conflict Resolution)

Ø¹Ù†Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù‚Ø¯ ØªØ­Ø¯Ø« ØªØ¹Ø§Ø±Ø¶Ø§Øª. Ø¥Ù„ÙŠÙƒ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:

| Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©              | Ø§Ù„ÙˆØµÙ                         | Ù…Ù†Ø§Ø³Ø¨ Ù„Ù€        |
| ------------------------- | ----------------------------- | --------------- |
| **Last Write Wins (LWW)** | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø« ÙŠÙÙˆØ²           | Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø­Ø±Ø¬Ø© |
| **Manual Merge**          | Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± | Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø©    |
| **Field-Level Merge**     | Ø¯Ù…Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ù‚Ù„ | ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø²Ø¦ÙŠØ©   |
| **Server Priority**       | Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø­Ù‚         | Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø§Ù„ÙŠØ©    |

```dart
// Ù…Ø«Ø§Ù„: Last Write Wins
class ConflictResolver {
  Order resolveConflict(Order local, Order remote) {
    if (local.updatedAt.isAfter(remote.updatedAt)) {
      return local;
    } else {
      return remote;
    }
  }
}
```

### 8.4 Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Risk Management)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Offline Transaction Risk Matrix                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Ø§Ù„Ù…Ø®Ø§Ø·Ø±                    â”‚ Ø§Ù„ØªØ®ÙÙŠÙ                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø±ÙÙˆØ¶Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹        â”‚ Ø­Ø¯ Ø£Ù‚ØµÙ‰ 100 Ø±ÙŠØ§Ù„ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø©     â”‚
â”‚  Ø¨Ø·Ø§Ù‚Ø© Ù…Ø³Ø±ÙˆÙ‚Ø©/Ù…Ù„ØºØ§Ø©         â”‚ Ù‚Ø§Ø¦Ù…Ø© Ø³ÙˆØ¯Ø§Ø¡ Ù…Ø­Ù„ÙŠØ© Ù…Ø­Ø¯Ø«Ø©       â”‚
â”‚  Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Queue        â”‚ Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ 4 Ø³Ø§Ø¹Ø§Øª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰   â”‚
â”‚  ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª             â”‚ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ            â”‚
â”‚  Ø¹Ø¬Ø² Ù…Ø§Ù„ÙŠ                   â”‚ ØªØ³Ø¬ÙŠÙ„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.5 ØªÙƒØ§Ù…Ù„ Ø¨Ù†Ùƒ Ø¥Ù†Ù…Ø§Ø¡ (Alinma Bank Integration)

> [!IMPORTANT]
> Ø¨Ù†Ùƒ Ø¥Ù†Ù…Ø§Ø¡ ÙŠÙˆÙØ± **API Portal** Ùˆ **E-Payment Gateway** ÙŠØ¯Ø¹Ù… Mada

#### Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„

| Ø§Ù„Ù…ØªØ·Ù„Ø¨               | Ø§Ù„ÙˆØµÙ                    |
| --------------------- | ------------------------ |
| **Alinma API Portal** | Ù…Ù†ØµØ© Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ù…Ø¹ Sandbox |
| **Ø­Ø³Ø§Ø¨ Ø¬Ø§Ø±ÙŠ**         | Ø­Ø³Ø§Ø¨ ÙÙŠ Ø¨Ù†Ùƒ Ø¥Ù†Ù…Ø§Ø¡        |
| **Ø³Ø¬Ù„ ØªØ¬Ø§Ø±ÙŠ**         | CR Ø³Ø§Ø±ÙŠ Ø§Ù„Ù…ÙØ¹ÙˆÙ„          |
| **HTTPS**             | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ù…Ø´ÙØ±Ø©     |

#### Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©

```dart
enum AlinmaPaymentMethod {
  mada,           // Ø´Ø¨ÙƒØ© Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø­Ù„ÙŠØ©
  visa,           // Visa Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©
  mastercard,     // Mastercard Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©
  madaPay,        // Mada Pay QR
}
```

### 8.6 ØªØµÙ…ÙŠÙ… Schema Ù…Ø­Ø³Ù‘Ù† (Enhanced Isar Schema)

```dart
@collection
class Order {
  Id id = Isar.autoIncrement;

  // Ù…Ø¹Ø±ÙØ§Øª ÙØ±ÙŠØ¯Ø©
  @Index(unique: true)
  String localId = const Uuid().v4();
  String? serverId;
  String? idempotencyKey; // Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±

  // Ø§Ù„Ø·ÙˆØ§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠØ©
  DateTime createdAt = DateTime.now();
  DateTime? updatedAt;
  DateTime? syncedAt;

  // Ø§Ù„Ù…Ø¨Ø§Ù„Øº
  double subtotal = 0;
  double taxAmount = 0;
  double totalAmount = 0;
  double paidAmount = 0;
  double? changeAmount;

  // Offline Limits
  bool isOfflineTransaction = false;
  double offlineLimit = 100.0; // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Offline

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¥Ø°Ø§ Ø±ÙÙØ¶Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©)
  String? customerPhone;

  @enumerated
  PaymentType paymentType = PaymentType.cash;

  @enumerated
  OrderStatus status = OrderStatus.pending;

  @enumerated
  SyncStatus syncStatus = SyncStatus.pending;

  // Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
  int syncRetryCount = 0;
  String? lastSyncError;

  final items = IsarLinks<OrderItem>();
}
```

### 8.7 Sync Worker Ù…Ø­Ø³Ù‘Ù† (Enhanced Sync Worker)

```dart
class EnhancedSyncWorker {
  static const int maxRetries = 3;
  static const Duration syncTimeout = Duration(hours: 24);

  Future<void> syncWithRetry() async {
    final pendingOrders = await _isar.orders
      .filter()
      .syncStatusEqualTo(SyncStatus.pending)
      .syncRetryCountLessThan(maxRetries)
      .createdAtGreaterThan(DateTime.now().subtract(syncTimeout))
      .findAll();

    for (final order in pendingOrders) {
      try {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Idempotency Key Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        final response = await _api.postOrder(
          order,
          headers: {'Idempotency-Key': order.idempotencyKey},
        );

        order.serverId = response.id;
        order.syncStatus = SyncStatus.synced;
        order.syncedAt = DateTime.now();

      } catch (e) {
        order.syncRetryCount++;
        order.lastSyncError = e.toString();

        if (order.syncRetryCount >= maxRetries) {
          order.syncStatus = SyncStatus.failed;
          await _notifyAdmin(order); // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ±
        }
      }

      await _isar.orders.put(order);
    }
  }

  Future<void> _expireOldTransactions() async {
    // Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¬Ø¯Ø§Ù‹
    final expiredOrders = await _isar.orders
      .filter()
      .syncStatusEqualTo(SyncStatus.pending)
      .createdAtLessThan(DateTime.now().subtract(Duration(hours: 72)))
      .findAll();

    for (final order in expiredOrders) {
      order.syncStatus = SyncStatus.expired;
      await _isar.orders.put(order);
      await _notifyAdmin(order);
    }
  }
}
```

---

## 9. Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ Ø£Ù†Ø¸Ù…Ø© POS Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©

| Ø§Ù„Ù…ÙŠØ²Ø©            | Toast (US) | Clover (US) | WashPOS (SA) |
| ----------------- | ---------- | ----------- | ------------ |
| Offline Mode      | âœ…         | âœ…          | âœ…           |
| Store-and-Forward | âœ…         | âœ…          | âœ…           |
| Transaction Limit | $200       | $100        | 100 Ø±.Ø³      |
| Sync Window       | 24h        | 72h         | 24h          |
| Local Database    | SQLite     | Proprietary | Isar         |
| ZATCA Compliance  | âŒ         | âŒ          | âœ…           |

---

## 10. Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©

> [!TIP] > **Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø°Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø³ØªÙ‚Ø±:**

1. âœ… **Ø§Ø³ØªØ®Ø¯Ù… Offline-First** Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
2. âœ… **Ø­Ø¯Ø¯ Ø³Ù‚Ù** Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Offline (100 Ø±ÙŠØ§Ù„)
3. âœ… **Ø§Ø­ÙØ¸ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„** Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„ÙƒÙ„ Ù…Ø¹Ø§Ù…Ù„Ø©
4. âœ… **Ø²Ø§Ù…Ù† ÙƒÙ„ 4 Ø³Ø§Ø¹Ø§Øª** ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
5. âœ… **Ø§Ø³ØªØ®Ø¯Ù… Idempotency** Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
6. âœ… **Ø´ÙÙ‘Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª** Ù…Ø­Ù„ÙŠØ§Ù‹ (AES-256)
7. âœ… **Ø§ØªØ¨Ø¹ PCI DSS** Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª

---

## 11. Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠ Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (POS-Like Flow)

> [!NOTE]
> Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù [UX_UI_POS_Analysis.md](./UX_UI_POS_Analysis.md)

### 11.1 Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

| Ø§Ù„Ù…Ø¤Ø´Ø± | Ø§Ù„Ù‡Ø¯Ù |
|--------|-------|
| ÙˆÙ‚Øª Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ | 20-30 Ø«Ø§Ù†ÙŠØ© |
| Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¯ÙØ¹ | 3-4 Ù†Ù‚Ø±Ø§Øª |
| ÙˆÙ‚Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© | < 3 Ø«ÙˆØ§Ù†ÙŠ |

### 11.2 ØªØ¯ÙÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

```
ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â†’ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø© â†’ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø¬Ù… â†’ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯ÙØ¹ â†’ (Ù†Ù‚Ø¯/Ø´Ø¨ÙƒØ©) â†’ ÙØ§ØªÙˆØ±Ø© + Ø³Ù†Ø¯ â†’ Ø·Ø¨Ø§Ø¹Ø©
```

### 11.3 Ù…Ù„Ø§Ø­Ø¸Ø§Øª UX Ø§Ù„Ø­Ø±Ø¬Ø©

- âŒ Ù„Ø§ Ù‚ÙˆØ§Ø¦Ù… Ù…Ù†Ø³Ø¯Ù„Ø©
- âŒ Ù„Ø§ Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
- âœ… Ù„Ù…Ø³Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
- âœ… Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø© (48dp+)
- âœ… Ø·Ø¨Ø§Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø³Ø¤Ø§Ù„

---

## 12. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±

### 12.1 Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØºØ³ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

| Ø§Ù„Ø®Ø¯Ù…Ø© | ØµØºÙŠØ± | ÙˆØ³Ø· | ÙƒØ¨ÙŠØ± |
|--------|------|-----|------|
| ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ | 30 Ø±.Ø³ | - | 35 Ø±.Ø³ |
| ØºØ³ÙŠÙ„ ØªØ±ÙƒÙˆØ§Ø² | 70 Ø±.Ø³ | 75 Ø±.Ø³ | 80 Ø±.Ø³ |
| ØºØ³ÙŠÙ„ ØªØ±ÙƒÙˆØ§Ø² Ø¨Ù„Ø³ | 85 Ø±.Ø³ | 90 Ø±.Ø³ | 95 Ø±.Ø³ |

### 12.2 Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¨Ø®Ø§Ø±

| Ø§Ù„Ø®Ø¯Ù…Ø© | ØµØºÙŠØ± | ÙƒØ¨ÙŠØ± |
|--------|------|------|
| ØºØ³ÙŠÙ„ Ø¨Ø®Ø§Ø± Ù‚Ù…Ø§Ø´ | 155 Ø±.Ø³ | 185 Ø±.Ø³ |
| ØºØ³ÙŠÙ„ Ø¨Ø®Ø§Ø± Ø¬Ù„Ø¯ | 115 Ø±.Ø³ | 135 Ø±.Ø³ |
| ØºØ³ÙŠÙ„ Ù…Ø§ÙƒÙŠÙ†Ø© Ø¨Ø®Ø§Ø± | 35 Ø±.Ø³ | - |

### 12.3 Ø®Ø¯Ù…Ø§Øª Ø§ÙƒØ³Ø¨Ø±Ø³

| Ø§Ù„Ø®Ø¯Ù…Ø© | ØµØºÙŠØ± | ÙˆØ³Ø· | ÙƒØ¨ÙŠØ± |
|--------|------|-----|------|
| ØºØ³ÙŠÙ„ Ø§ÙƒØ³Ø¨Ø±Ø³ | 45 Ø±.Ø³ | 50 Ø±.Ø³ | 55 Ø±.Ø³ |
| ØºØ³ÙŠÙ„ Ø§ÙƒØ³Ø¨Ø±Ø³ Ø¨Ø¯ÙˆÙ† ÙƒÙŠØ³ | 40 Ø±.Ø³ | - | - |

### 12.4 Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ¹

| Ø§Ù„Ø®Ø¯Ù…Ø© | ØµØºÙŠØ± | ÙˆØ³Ø· | ÙƒØ¨ÙŠØ± |
|--------|------|-----|------|
| ØªÙ„Ù…ÙŠØ¹ Ø®Ø§Ø±Ø¬ÙŠ Ø¨ÙˆØ§ÙƒØ³ Ø·Ø¨Ù‚Ø© Ø§Ù„Ù†Ø§Ù†Ùˆ | 99 Ø±.Ø³ | 107 Ø±.Ø³ | 114 Ø±.Ø³ |
| ØªÙ„Ù…ÙŠØ¹ ÙƒÙØ±Ø§Øª | 5 Ø±.Ø³ | - | - |

### 12.5 Ø¥Ø¶Ø§ÙØ§Øª Ø£Ø®Ø±Ù‰

| Ø§Ù„Ø®Ø¯Ù…Ø© | Ø§Ù„Ø³Ø¹Ø± |
|--------|-------|
| ÙƒÙŠØ³ Ø¯Ø¹Ø§Ø³Ø§Øª | 5 Ø±.Ø³ |
| Ù…Ø§Ø¡ | 10 Ø±.Ø³ |
| Ø¯Ø§Ø®Ù„ÙŠØ© ØµØºÙŠØ± | 15 Ø±.Ø³ |
| Ø¯Ø§Ø®Ù„ÙŠØ© ÙƒØ¨ÙŠØ± | 20 Ø±.Ø³ |
| Ø®Ø§Ø±Ø¬ÙŠØ© | 25 Ø±.Ø³ |
| Ø¯ÙØªØ± ÙƒÙˆØ¨ÙˆÙ†Ø§Øª | 600 Ø±.Ø³ |

---

## 13. Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠ Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†

> [!TIP]
> Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ù€ Code SamplesØŒ Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù [Technical_Developer_Analysis.md](./Technical_Developer_Analysis.md)
